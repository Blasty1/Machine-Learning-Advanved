\documentclass[a4paper]{article}

\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{xcolor}

\newcommand{\elbo}{\mathcal{L}}
\newcommand{\E}{\mathbb{E}}
\newcommand{\p}{p}
\newcommand{\q}{q}

\title{E1 - Assignment}
\author{
Bruno Carchia \\
\texttt{carchia@kth.se}
\and
Riccardo Alfonso Cerrone \\
  \texttt{cerrone@kth.se}
}

\begin{document}
\maketitle

\begin{align*}
\mathbb{P}(X_2 = x_2 \big | X_4 = \text{thin}) &= \dfrac{\mathbb{P}( X_4 = \text{thin} \big | X_2 = x_2) \mathbb{P}(X_2 = x_2)}{\mathbb{P}(X_4 = \text{thin})}
\\
& \propto \mathbb{P}( X_4 = \text{thin} \big | X_2 = x_2) \mathbb{P}(X_2 = x_2)
\\ 
&= \mathbb{P}( X_4 = \text{thin} \big | X_2 = x_2) \sum_{x_1}\mathbb{P}(X_2 = x_2, X_1=x_1)
\\
&= \mathbb{P}( X_4 = \text{thin} \big | X_2 = x_2) \sum_{x_1}\mathbb{P}(X_2 = x_2 \big| X_1=x_1)\mathbb{P}(X_1=x_1)
\end{align*}

\newpage

\begin{align*}
\mathbb{P}(X_1=x_1 \big | X_3 = \text{medium}, X_4 = \text{thin}) &= \dfrac{\mathbb{P}(X_1=x_1, X_3 = \text{medium}, X_4 = \text{thin})}{\mathbb{P}(X_3 = \text{medium})\mathbb{P}(X_4 = \text{thin} \big | X_3 = \text{medium})}
\\
& \propto \mathbb{P}(X_1=x_1, X_3 = \text{medium}, X_4 = \text{thin})
\\
&= \mathbb{P}(X_1 = x_1) \textcolor{red}{\mathbb{P}(X_3= \text{medium} \big | X_1 = x_1)} \\
& \textcolor{blue}{\mathbb{P}(X_4 = \text{thin} \big | X_3 = \text{medium}, X_1 = x_1)}
\end{align*}

\begin{align*}
\textcolor{blue}{\mathbb{P}(X_4 = \text{T} \big | X_3 = \text{M}, X_1 = x_1)} &= \sum_{x_2} \mathbb{P}(X_4= \text{T}, X_2 = x_2 \big |X_3 = \text{M}, X_1 = x_1) 
\\
&= \sum_{x_2} \mathbb{P}(X_4= \text{T}, X_2 = x_2 \big |X_3 = \text{M}, X_1 = x_1) 
\end{align*}

\newpage

\begin{align*}
\elbo 
&= \E_q \left[ \log \frac{\p(D, \mu, \tau)}{\q(\mu, \tau)} \right] \\
&= \E_q [\log \p(D, \mu, \tau)] - \E_q [\log \q (\mu, \tau)]\\
&= \textcolor{red}{\E_q [\log \p (\mu \mid \lambda_0, \mu_0, \tau)]}
+ \textcolor{blue}{\E_q [\log \p (\tau \mid a_0, b_0)]} 
+ \textcolor{olive}{\E_q [\log \p (D \mid \mu, \tau)]}
\\ &\quad- \textcolor{orange}{\E_q [\log \q (\mu)]} 
- \textcolor{magenta}{\E_q [\log \q (\tau)]}
\end{align*}

\begin{align*}
\textcolor{red}{\E_q [\log \p (\mu \mid \lambda_0, \mu_0, \tau)]}
&= \E_q \bigg[ \frac{1}{2} \log \tau 
+ \frac{1}{2} \log \frac{\lambda_0}{2 \pi} 
- \frac{1}{2}\lambda_0 \tau (\mu - \mu_0)^2\bigg]
\\
&= \frac{1}{2} \log \frac{\lambda_0}{2 \pi} 
+ \frac{1}{2} \E_q [\log \tau ] 
- \frac{1}{2}\lambda_0 \E_q [\tau]\Big(\E_q[\mu^2]-2\mu_0\E_q[\mu]+\mu_0^2\Big)
\end{align*}

\begin{align*}
\textcolor{blue}{\E_q [\log \p (\tau \mid a_0, b_0)]} 
&= \E_q\big[a_0 \log b_0 - \log \Gamma(a_0) + (a_0 -1)\log \tau - b_0 \tau\big]\\
&= a_0 \log b_0 - \log \Gamma(a_0) 
+ (a_0 -1) \E_q[\log \tau] - b_0 \E_q[\tau]
\end{align*}

\begin{align*}
\textcolor{olive}{\E_q [\log \p (D \mid \mu, \tau)]} 
&= \E_q \bigg[ \log \bigg(\prod_{n = 1}^{N} \p (x_n \mid \mu, \tau)\bigg)\bigg]  
= \E_q \bigg[ \sum_{n = 1}^{N} \log \p (x_n \mid \mu, \tau)\bigg]
\\
&= \sum_{n = 1}^{N} \E_q \bigg[\log \p (x_n \mid \mu, \tau)\bigg] 
= \sum_{n = 1}^{N} \E_q \bigg[\log \bigg(\sqrt{\frac{\tau}{2 \pi}} 
\, e^{-\frac{\tau}{2}(x_n - \mu)^2}\bigg)\bigg] 
\\
&= \sum_{n = 1}^{N} \E_q \bigg[ \frac{1}{2}\log \tau 
- \frac{1}{2} \log (2 \pi) 
- \frac{\tau}{2}(x_n - \mu)^2 \bigg] 
\\
&= \frac{N}{2} \E_q [\log \tau] - \frac{N}{2} \log (2 \pi)
- \frac{1}{2} \E_q[\tau] 
\sum_{n = 1}^{N} \E_q\big[(x_n - \mu)^2\big]
\\
&= \frac{N}{2} \E_q [\log \tau] - \frac{N}{2} \log (2 \pi)
- \frac{1}{2} \E_q[\tau] 
\bigg(\sum_{n = 1}^{N} x_n^2 
- 2 \E_q[\mu]\sum_{n = 1}^{N} x_n 
+ N \E_q[\mu^2]\bigg)
\end{align*}

\begin{align*}
\textcolor{orange}{\E_q [\log \q (\mu)]} 
&= \E_q \bigg[\log \bigg(\sqrt{\frac{\lambda_N}{2 \pi}} 
\, e^{-\frac{\lambda_N}{2}(\mu - \mu_N)^2}\bigg)\bigg] 
\\
&= \E_q \bigg[ \frac{1}{2}\log \frac{\lambda_N}{2 \pi} 
- \frac{\lambda_N}{2}(\mu - \mu_N)^2 \bigg] 
\\
&= \frac{1}{2}\log \frac{\lambda_N}{2 \pi} 
- \frac{\lambda_N}{2} \E_q \big[(\mu - \mu_N)^2\big]
\\
&= \frac{1}{2}\log \frac{\lambda_N}{2 \pi} 
- \frac{\lambda_N}{2} \cdot \frac{1}{\lambda_N}
\\
&= \frac{1}{2}\bigg(\log \frac{\lambda_N}{2 \pi} - 1\bigg)
\end{align*}

\begin{align*}
\textcolor{magenta}{\E_q [\log \q (\tau)]} 
&= \E_q\big[a_N \log b_N - \log \Gamma(a_N) + (a_N -1)\log \tau - b_N \tau\big]\\
&= a_N \log b_N - \log \Gamma(a_N) 
+ (a_N -1) \E_q[\log \tau] - b_N \E_q[\tau]
\end{align*}

\end{document}